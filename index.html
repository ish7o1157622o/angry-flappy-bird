<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=1024, initial-scale=1.0, user-scalable=no" />
<title>Flappy - Fixed</title>
<style>
* { margin: 0; box-sizing: border-box; }
body { height: 100%; font-family: Arial, sans-serif; }
header { width: 100%; padding: 10px; text-align: right; }
header a { text-decoration: none; color: #333; font-weight: bold; font-size: 18px; padding: 6px 12px; background: #fff; border: 1px solid #ccc; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
main { display: flex; justify-content: center; align-items: center; margin-top: 10px; }
.ad-space { width: 350px; height: 50px; margin: 0 10px; background: #eee; display: flex; justify-content: center; align-items: center; font-size: 14px; color: #555; border: 1px dashed #aaa; }
.game-wrapper { width: 640px; height: 640px; position: relative; overflow: hidden; background: #fff; box-shadow: 0 0 10px rgba(0,0,0,0.3); }
canvas { display: block; touch-action: none; }
#startText { position: absolute; top: 40%; width: 100%; text-align: center; font-size: 2em; color: #333; font-weight: bold; text-shadow: 1px 1px 2px white; user-select: none; pointer-events: none; }
footer { margin-top: 20px; padding: 10px; font-size: 14px; color: #666; }
.control-btn { position: absolute; z-index: 20; }
</style>
</head>
<body>
<header>
  <a href="https://tools4dailyneedgamesme.odoo.com/" target="_blank">Home</a>
</header>
<main>
  <div class="ad-space">Ad Space (Left 350x50)</div>
  <div class="game-wrapper">
    <div id="startText">Tap or Press Space to Start</div>
    <canvas id="gameCanvas" width="640" height="640"></canvas>
  </div>
  <div class="ad-space">Ad Space (Right 350x50)</div>
</main>
<footer>
  Â© AnupamTech_Arts
</footer>

<!-- Background audio: use the provided file in same folder -->
<audio id="bgMusic" src="782060__looplicator__192-bpm-industrial-drum-loop-12023-wav" preload="auto" loop></audio>
<audio id="sound-jump" src="jump.mp3" preload="auto"></audio>
<audio id="sound-score" src="score.wav" preload="auto"></audio>
<audio id="sound-hit" src="hit.mp3" preload="auto"></audio>

<script>
// Fixed and cleaned game script
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Bird
const bird = {
  x: 120,
  y: canvas.height / 2,
  width: 40,
  height: 30,
  velocity: 0
};

const gravity = 0.6;
const jump = -10;
const pipeGap = 200; // gap between top and bottom
const pipeWidth = 80;
let pipes = [];
let score = 0;
let gameRunning = false;
let lastPipeTime = 0;

// Audio elements
const sounds = {
  jump: document.getElementById('sound-jump'),
  score: document.getElementById('sound-score'),
  hit: document.getElementById('sound-hit'),
  bg: document.getElementById('bgMusic')
};
// set bg volume and playback rate as requested
if (sounds.bg) {
  sounds.bg.volume = 0.25;
  try { sounds.bg.playbackRate = 0.5; } catch (e) { /* ignore */ }
}
if (sounds.jump) sounds.jump.volume = 0.25;
if (sounds.score) sounds.score.volume = 0.25;
if (sounds.hit) sounds.hit.volume = 0.25;

const startText = document.getElementById('startText');

function restartGame() {
  pipes = [];
  score = 0;
  bird.y = canvas.height / 2;
  bird.velocity = 0;
  gameRunning = true;
  startText.style.display = 'none';
  lastPipeTime = performance.now();
  // start/rewind bg music if allowed
  if (sounds.bg) {
    sounds.bg.currentTime = 0;
    sounds.bg.play().catch(() => {});
  }
}

function createPipe() {
  const topHeight = Math.floor(Math.random() * (canvas.height - pipeGap - 200)) + 50;
  const bottomY = topHeight + pipeGap;
  pipes.push({ x: canvas.width, top: topHeight, bottom: bottomY, passed: false, color: randomColor() });
}

function randomColor() {
  const colors = ['#8B4513', '#A0522D', '#CD853F', '#D2691E', '#A52A2A'];
  return colors[Math.floor(Math.random() * colors.length)];
}

function drawBackground() {
  ctx.fillStyle = '#fff';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  // simple moving circles background
  const count = 6;
  const t = Date.now();
  ctx.fillStyle = '#f6f6f6';
  for (let i = 0; i < count; i++) {
    const x = (t / 20 + i * 300) % (canvas.width + 200) - 200;
    const y = 80 + Math.sin(i + t / 500) * 30;
    ctx.beginPath();
    ctx.arc(x, y, 30, 0, Math.PI * 2);
    ctx.arc(x + 30, y + 10, 40, 0, Math.PI * 2);
    ctx.arc(x + 80, y, 30, 0, Math.PI * 2);
    ctx.fill();
  }
}

function drawBird() {
  ctx.fillStyle = '#FFD700';
  ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
}

function drawPipes() {
  for (const pipe of pipes) {
    ctx.fillStyle = pipe.color;
    // top pipe
    ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
    // bottom pipe
    ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom);
    // decorative caps
    ctx.fillStyle = '#5D982A';
    ctx.fillRect(pipe.x - 5, pipe.top - 10, pipeWidth + 10, 10);
    ctx.fillRect(pipe.x - 5, pipe.bottom, pipeWidth + 10, 10);
    // rings
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 4;
    ctx.strokeRect(pipe.x + pipeWidth * 0.2, pipe.top - 10, pipeWidth * 0.6, 10);
    ctx.strokeRect(pipe.x + pipeWidth * 0.2, pipe.bottom, pipeWidth * 0.6, 10);
  }
}

function updateGame(delta) {
  if (!gameRunning) return;
  bird.velocity += gravity;
  bird.y += bird.velocity;

  // spawn pipes every ~1500ms
  if (performance.now() - lastPipeTime > 1500) {
    createPipe();
    lastPipeTime = performance.now();
  }

  for (let i = pipes.length - 1; i >= 0; i--) {
    const p = pipes[i];
    p.x -= 4;

    // scoring
    if (!p.passed && bird.x > p.x + pipeWidth) {
      p.passed = true;
      score++;
      if (sounds.score) { sounds.score.currentTime = 0; sounds.score.play().catch(()=>{}); }
    }

    // collision
    const hitX = bird.x < p.x + pipeWidth && bird.x + bird.width > p.x;
    const hitY = bird.y < p.top || (bird.y + bird.height > p.bottom);
    if (hitX && hitY) {
      // hit
      if (sounds.hit) { sounds.hit.currentTime = 0; sounds.hit.play().catch(()=>{}); }
      gameRunning = false;
      if (sounds.bg) sounds.bg.pause();
      startText.style.display = 'block';
    }

    // cleanup
    if (p.x + pipeWidth < 0) pipes.splice(i,1);
  }

  // out of bounds
  if (bird.y + bird.height > canvas.height || bird.y < 0) {
    if (sounds.hit) { sounds.hit.currentTime = 0; sounds.hit.play().catch(()=>{}); }
    gameRunning = false;
    if (sounds.bg) sounds.bg.pause();
    startText.style.display = 'block';
  }
}

function drawScore() {
  ctx.fillStyle = '#000';
  ctx.font = '30px Arial';
  ctx.fillText(`Score: ${score}`, 20, 40);
}

let lastTime = performance.now();
function gameLoop() {
  const now = performance.now();
  const delta = now - lastTime;
  lastTime = now;

  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawBackground();
  drawPipes();
  drawBird();
  drawScore();
  updateGame(delta);

  requestAnimationFrame(gameLoop);
}

// Start loop
gameLoop();

// Controls
window.addEventListener('keydown', e => {
  if (e.code === 'Space') {
    if (!gameRunning) restartGame();
    bird.velocity = jump;
    if (sounds.jump) { sounds.jump.currentTime = 0; sounds.jump.play().catch(()=>{}); }
  }
});
window.addEventListener('click', () => {
  if (!gameRunning) restartGame();
  bird.velocity = jump;
  if (sounds.jump) { sounds.jump.currentTime = 0; sounds.jump.play().catch(()=>{}); }
});

// Enable background audio after first interaction (browser policy)
function enableAudio() {
  if (sounds.bg) sounds.bg.play().catch(()=>{});
  window.removeEventListener('click', enableAudio);
  window.removeEventListener('keydown', enableAudio);
}
window.addEventListener('click', enableAudio);
window.addEventListener('keydown', enableAudio);

</script>

<!-- Ad options script left as-is (kept but moved after main script) -->
<script type="text/javascript">
var atOptions = { 'key' : 'c91750109f3bb52677ddd12609310aa2', 'format' : 'iframe', 'height' : 90, 'width' : 728, 'params' : {} };
</script>

</body>
</html>
